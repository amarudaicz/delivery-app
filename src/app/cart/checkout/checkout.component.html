<div class="mt-3">

  <div class="container-title d-flex gap-2">
    <button (click)="location.back()" class="chip border-round bg-bluegray-800 cursor-pointer hover:bg-black-alpha-90">
      <i class="pi pi-chevron-left text-white" style="margin-top: 2px;"></i>
    </button>

    <h2 [style.color]="theme.get('colorTextSecondary')" [style.background]="theme.get('backgroundSec')"
      class="chip title-cart w-full">Checkout</h2>
  </div>

  <form [formGroup]="form" (submit)="preLeave()" class="checkout-form" *ngIf="localService.local$ | async as local">

    <div class="mb-1">
      <label class="text-base font-bold mb-1">Nombre completo</label>
      <mat-form-field class="input-group" color="primary" appearance="outline">
        <input placeholder="Ingresa tu nombre completo" type="text" matInput formControlName="name" />
        <mat-error>{{setErrorsMessage('name')}}</mat-error>
      </mat-form-field>
    </div>



    <div class="mb-1"  *ngIf="local.shipping.delivery || local.shipping.pick_in_local">
      <label class="text-base font-bold mb-1">Metodo de envio</label>
      <mat-form-field class="input-group" appearance="outline">
        <mat-select placeholder="Selecciona un metodo de envio" formControlName="shippingMethod">
          <mat-option value="Delivery" *ngIf="local.shipping.delivery">
            Delivery
          </mat-option>
          <mat-option value="Local" *ngIf="local.shipping.pick_in_local">
            Buscar en el local
          </mat-option>
        </mat-select>
        <p class="alert-form" *ngIf="this.form.controls['shippingMethod'].value === 'Delivery'"
          [style.color]="theme.get('background')">
          El costo del envio puede variar dependiendo la zona, le indicaremos el monto atravez de Whatsapp
        </p>
        <mat-error>{{setErrorsMessage('shippingMethod')}}</mat-error>
      </mat-form-field>
    </div>


    <div class="mb-1" *ngIf="form.controls['shippingMethod'].value === 'Delivery' ">
      <label class="text-base font-bold mb-1">Direccion</label>
      <mat-form-field appearance="outline" 
        class="input-group" color="primary">
        <input placeholder="Ingresa tu direccion" type="text" matInput formControlName="direction" />
        <mat-error>{{setErrorsMessage('direction')}}</mat-error>
      </mat-form-field>

      <label class="text-base font-bold mb-1">Referencia de la casa (opcional)</label>
      <mat-form-field appearance="outline" class="input-group">
        <textarea formControlName="reference" matInput placeholder="Ej. Casa color rojo, porton de madera"></textarea>
      </mat-form-field>
    </div>

    
    <div class="mb-1" *ngIf="local.pay_methods.delivery || local.pay_methods.transfer">
      <label class="text-base font-bold mb-1">Metodo de pago</label>
      <mat-form-field  class="input-group"
      appearance="outline">
      <mat-select placeholder="Elije un metodo de pago" formControlName="payMethod">
        <mat-option value="Efectivo" *ngIf="local.pay_methods.cash">
          Efectivo
        </mat-option>

        <mat-option value="Transferencia" *ngIf="local.pay_methods.transfer">
          Transferencia
        </mat-option>
      </mat-select>

      <p class="alert-form" *ngIf="this.form.controls['payMethod'].value === 'Transferencia'"
        [style.color]="theme.get('background')">
        Le indicaremos el destino de la transferencia una vez realizado el pedido
      </p>

      <mat-error>{{setErrorsMessage('payMethod')}}</mat-error>
    </mat-form-field>
    </div>

   

    <div class="" 
      *ngIf="this.form.controls['payMethod'].value === 'Efectivo' 
      && this.form.controls['shippingMethod'].value === 'Delivery'">

      <label class="text-base font-bold mb-1">Con cuanto pagar√° (opcional)</label>
      <mat-form-field
        class="input-group" color="primary">
        <input type="number" matInput formControlName="amountReceived" />
        <span matTextPrefix>$&nbsp;</span>
        <span matTextSuffix>.00</span>
      </mat-form-field>
    </div>


    <div class="container-details mt-3">
      <p class="details-checkout subtotal"><b>Subtotal:</b> <span>{{subtotal|currency}}</span> </p>
      <p *ngIf="this.form.controls['shippingMethod'].value === 'Delivery'" class="details-checkout "><b>Envio:</b>

        <i #tooltip="matTooltip"
          matTooltip="El costo del envio puede variar dependiendo la zona, le indicaremos el monto atravez de Whatsapp"
          matTooltipPosition="above" matTooltipTouchGestures="on" TooltipVisibility="initial" (click)="tooltip.show()"
          [style.color]="theme.get('background')" class="pi pi-info-circle"></i>
      </p>

    </div>

    <button [style.background]="theme.get('background')" [style.color]="theme.get('colorTextSecondary')" type="submit">
      Enviar
    </button>
  </form>


</div>